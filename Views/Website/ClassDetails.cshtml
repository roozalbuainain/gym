@model GYM_APP.ViewModels.WebsiteVMs.ClassDetailsViewModel
@{
    ViewData["Title"] = "Class Details";
}

<partial name="_Navbar" />

<div class="container py-5">
    <div class="col-md-12">
        <div class="card shadow-lg h-100">
            <div class="row g-0">
                <div class="col-md-4">
                    <img src="~/images/class.jpg" class="img-fluid h-100 rounded-start object-fit-cover" alt="@Model.ClassName">
                </div>
                <div class="col-md-8">
                    <div class="card-body">
                        <h5 class="card-title text-danger">
                            <i class="fas fa-dumbbell me-2"></i>@Model.ClassName
                        </h5>
                        <p class="card-text text-muted">@Model.ClassDescription</p>
                        @if (Model.Schedules.Any())
                        {
                            <h6 class="mt-3 fw-semibold">Weekly Schedule:</h6>
                            <div class="d-flex flex-wrap gap-2 mt-2">
                                @foreach (var schedule in Model.Schedules)
                                {
                                    <div class="schedule-badge border rounded-pill px-3 py-2 d-flex align-items-center shadow-sm bg-light text-dark">
                                        <i class="fas fa-calendar-alt me-2 text-primary"></i>
                                        <span class="fw-semibold text-capitalize">@schedule.DayOfWeek</span>
                                        <span class="mx-2 text-muted">|</span>
                                        <i class="fas fa-clock me-1 text-danger"></i>
                                        <span class="fw-bold">@schedule.Time?.ToString("h:mm tt")</span>
                                    </div>
                                }
                            </div>
                            <hr>
                            @if (Model.AvgRating.HasValue)
                            {
                                <p class="mb-2">
                                    <i class="fas fa-star text-warning"></i>
                                    <span class="fw-semibold">Avg Rating:</span> @Model.AvgRating.Value.ToString("N1")/5
                                </p>
                            }
                        }
                        else
                        {
                            <p class="text-muted"><em>No scheduled sessions.</em></p>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    <hr>

    <h4 class="text-dark mb-4">Class Reviews</h4>

    @if (Model.Reviews.Any())
    {
        @foreach (var review in Model.Reviews)
        {
            <div class="border rounded p-3 mb-3 shadow-sm">
                <div class="d-flex justify-content-between align-items-center mb-1">
                    <div>
                        <strong>@review.UserName</strong>
                    </div>
                    <small class="text-muted">
                        @review.Date.ToString("d") | @review.Time.ToString(@"hh\:mm")
                    </small>
                </div>
                <div class="text-warning mb-2">
                    @for (int i = 1; i <= 5; i++)
                    {
                        <i class="fas fa-star@(i <= review.Rating ? "" : "-o")"></i>
                    }
                </div>
                <p class="mb-0 text-dark">@(review.Comment ?? "No comment.")</p>
            </div>
        }
    }
    else
    {
        <p class="text-muted">No reviews yet. Be the first to review this class!</p>
    }

    <hr class="my-5">

    @if (Model.IsSubscribed)
    {
        <h5 class="mb-3">Leave a Review</h5>
        <form method="post" asp-action="AddReview" asp-controller="Member" class="border p-4 rounded shadow-sm">
            <input type="hidden" name="classId" value="@Model.ClassId">

            <div class="mb-3">
                <label for="rating" class="form-label">Rating (1-5)</label>
                <input type="number" name="rating" min="1" max="5" class="form-control" required>
            </div>

            <div class="mb-3">
                <label for="comment" class="form-label">Your Comment</label>
                <textarea name="comment" class="form-control" rows="4" placeholder="Write something about the class..."></textarea>
            </div>

            <button type="submit" class="btn btn-success">
                <i class="fas fa-paper-plane me-1"></i> Submit Review
            </button>
        </form>
    }
    else
    {
        <div class="alert alert-info text-center">
            <i class="fas fa-info-circle me-1"></i>
            You must be subscribed to this class to leave a review.
        </div>
    }
</div>